<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>סתם סת"ם - בדיקת פרשה</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <span class="icon">📜</span>
                    StamStam
                </h1>
                <div class="user-info">
                    <span id="userEmail" class="user-email"></span>
                    <button id="logoutBtn" class="btn-logout" title="התנתק">🚪</button>
                </div>
            </div>
        </header>

        <main class="app-main">
            <div class="main-layout">
                <!-- Panneau gauche : Image -->
                <div class="left-image-panel" id="leftImagePanel">
                    <div class="panel-header">
                        <div class="header-left">
                            <button class="btn-upload-small" id="uploadBtnSmall" title="בחר תמונה">
                                <span class="upload-icon-small">📄</span>
                                <span class="upload-text-small">בחר תמונה</span>
                            </button>
                            <input type="file" id="fileInput" accept="image/*" class="file-input">
                            <div class="file-info-small" id="fileInfoSmall"></div>
                        </div>
                        <div class="header-right">
                            <h2 class="panel-title" id="panelTitleLeft">תמונה</h2>
                            <div class="panel-actions">
                                <button class="btn-icon" id="cropBtn" title="חתוך תמונה" style="display: none;">
                                    ✂️
                                </button>
                                <button class="btn-icon" id="applyCropBtn" title="החל חיתוך" style="display: none;">
                                    ✓
                                </button>
                                <button class="btn-icon" id="acceptCropBtn" title="אשר חיתוך" style="display: none;">
                                    ✓
                                </button>
                                <button class="btn-icon" id="cancelCropBtn" title="בטל חיתוך" style="display: none;">
                                    ✕
                                </button>
                                <button class="btn-icon" id="zoomOutBtn" title="הקטן" style="display: none;">
                                    ➖
                                </button>
                                <button class="btn-icon" id="zoomInBtn" title="הגדל" style="display: none;">
                                    ➕
                                </button>
                                <button class="btn-icon" id="resetZoomBtn" title="איפוס זום" style="display: none;">
                                    🔍
                                </button>
                                <button class="btn-icon" id="downloadBtn" title="הורד תמונה" style="display: none;">
                                    💾
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="image-viewer" id="imageViewer">
                        <div class="image-placeholder">
                            <div class="placeholder-icon">🖼️</div>
                            <p class="placeholder-text">לא נבחרה תמונה</p>
                            <p class="placeholder-hint">בחר תמונה למעלה כדי להתחיל</p>
                        </div>
                        <div class="image-zoom-container" id="imageZoomContainer" style="display: none;">
                            <img id="displayImage" class="display-image" alt="Image">
                        </div>
                    </div>

                    <div class="panel-footer-left">
                        <div class="action-buttons">
                            <button class="btn btn-success" id="detectLettersBtn" disabled>
                                <span class="btn-text">בדוק פרשה</span>
                                <span class="btn-loader"></span>
                            </button>
                            <button class="btn btn-secondary" id="resetBtn" style="display: none;">
                                תמונה חדשה
                            </button>
                        </div>
                        <div class="crop-controls" id="cropControls" style="display: none;">
                            <p class="crop-hint">התאם את אזור הבחירה על ידי הזזת המלבן או שינוי גודל עם הידיות</p>
                        </div>
                    </div>

                    <!-- État de chargement -->
                    <section class="loading-section" id="loadingSection">
                        <div class="loading-spinner"></div>
                        <p class="loading-text">מנתח...</p>
                        <p class="loading-subtext">אנא המתן בזמן העיבוד</p>
                    </section>

                    <!-- Messages d'erreur -->
                    <section class="error-section" id="errorSection">
                        <div class="error-card">
                            <div class="error-icon">⚠️</div>
                            <h3 class="error-title">שגיאה</h3>
                            <p class="error-message" id="errorMessage"></p>
                            <button class="btn btn-secondary" id="errorCloseBtn">סגור</button>
                        </div>
                    </section>
                </div>

                <!-- Resizer -->
                <div class="panel-resizer" id="panelResizer"></div>

                <!-- Panneau droit : Résultats -->
                <div class="right-results-panel" id="rightResultsPanel">
                    <div class="panel-header">
                        <h2 class="panel-title" id="panelTitleRight">תוצאות</h2>
                    </div>

                    <div class="panel-content-scrollable" id="panelContentScrollable">
                        <div class="image-info" id="imageInfo" style="display: none;">
                            <div class="info-item">
                                <span class="info-label">פרשה מזוהה:</span>
                                <span class="info-value" id="parachaName">-</span>
                                <span class="info-value status-pill" id="parachaStatus" style="margin-right:8px;"></span>
                                <span class="info-value status-pill" id="errorsStatus" style="margin-right:8px;"></span>
                                <span id="successMessage" style="display: none; margin-right: 10px;"></span>
                            </div>
                            
                            <div class="info-item filter-spaces-container" style="margin-top: 10px; display: none;" id="filterSpacesContainer">
                                <label for="showSpaceErrors" style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 1.1em;">
                                    <input type="checkbox" id="showSpaceErrors" style="transform: scale(1.5); cursor: pointer;">
                                    <span>הצג שגיאות רווחים</span>
                                </label>
                            </div>

                            <div class="info-item" id="detectedTextItem" style="display: none;">
                                <span class="info-label">טקסט מזוהה:</span>
                                <div class="info-value detected-text" id="detectedText" style="display: block;">-</div>
                            </div>
                        </div>

                        <div class="legend" id="legend" style="display: none;">
                            <div class="legend-title">מקרא</div>
                            <div class="legend-items">
                                <div class="legend-item">
                                    <div class="legend-color legend-green"></div>
                                    <span class="legend-label">אותיות נכונות</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-red"></div>
                                    <span class="legend-label">אותיות חסרות</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-blue"></div>
                                    <span class="legend-label">אותיות מיותרות</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-orange"></div>
                                    <span class="legend-label">אותיות שגויות</span>
                                </div>
                            </div>
                        </div>

                        <div class="check-disclaimer" id="checkDisclaimer" style="display: none;">
                            <p class="check-disclaimer-text">שים לב: הבדיקה מתמקדת אך ורק בזיהוי אותיות יתירות, אותיות חסרות ואותיות שגויות.</p>
                            <p class="check-disclaimer-text">המערכת אינה בודקת את המרווחים בין המילים, ואינה מהווה בדיקת כשרות לצורת האותיות עצמן.</p>
                        </div>
                        
                        <div class="differences-section" id="differencesInfo" style="display: none;">
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="app-footer">
            <p>&copy; 2024 סתם סת"ם - בדיקת פרשה</p>
        </footer>
    </div>

    <script>
        // Vérifier la connexion avant de charger l'application
        window.addEventListener('DOMContentLoaded', () => {
            const userEmail = localStorage.getItem('stamstam_user_email');
            if (!userEmail) {
                window.location.href = 'login.html';
            }
        });
    </script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
