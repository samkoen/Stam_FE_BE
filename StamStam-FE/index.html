<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>סתם סת"ם - בדיקת פרשה</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <span class="icon">📜</span>
                    StamStam
                </h1>
                <div class="user-info">
                    <span id="userEmail" class="user-email"></span>
                    <button id="logoutBtn" class="btn-logout" title="התנתק">🚪</button>
                </div>
            </div>
        </header>

        <main class="app-main">
            <div class="main-layout">
                <!-- Colonne gauche : Upload et contrôles -->
                <div class="left-panel">
                    <section class="upload-section" id="uploadSection">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-content">
                                <div class="upload-icon">📄</div>
                                <h2 class="upload-title">בחר תמונה</h2>
                                <input type="file" id="fileInput" accept="image/*" class="file-input">
                            </div>
                            <div class="file-info" id="fileInfo"></div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary" id="processBtn" disabled>
                                <span class="btn-text">עבד תמונה</span>
                                <span class="btn-loader"></span>
                            </button>
                            <button class="btn btn-success" id="detectLettersBtn" disabled>
                                <span class="btn-text">זהה אותיות</span>
                                <span class="btn-loader"></span>
                            </button>
                            <button class="btn btn-secondary" id="resetBtn" style="display: none;">
                                תמונה חדשה
                            </button>
                        </div>
                        <div class="crop-controls" id="cropControls" style="display: none;">
                            <p class="crop-hint">התאם את אזור הבחירה על ידי הזזת המלבן או שינוי גודל עם הידיות</p>
                        </div>
                    </section>

                    <!-- État de chargement -->
                    <section class="loading-section" id="loadingSection">
                        <div class="loading-spinner"></div>
                        <p class="loading-text">מנתח...</p>
                        <p class="loading-subtext">אנא המתן בזמן העיבוד</p>
                    </section>

                    <!-- Messages d'erreur -->
                    <section class="error-section" id="errorSection">
                        <div class="error-card">
                            <div class="error-icon">⚠️</div>
                            <h3 class="error-title">שגיאה</h3>
                            <p class="error-message" id="errorMessage"></p>
                            <button class="btn btn-secondary" id="errorCloseBtn">סגור</button>
                        </div>
                    </section>
                </div>

                <!-- Colonne droite : Affichage de l'image -->
                <div class="right-panel" id="rightPanel">
                    <div class="panel-header">
                        <h2 class="panel-title" id="panelTitle">תצוגה מקדימה</h2>
                        <div class="panel-actions">
                            <button class="btn-icon" id="cropBtn" title="חתוך תמונה" style="display: none;">
                                ✂️
                            </button>
                            <button class="btn-icon" id="applyCropBtn" title="החל חיתוך" style="display: none;">
                                ✓
                            </button>
                            <button class="btn-icon" id="acceptCropBtn" title="אשר חיתוך" style="display: none;">
                                ✓
                            </button>
                            <button class="btn-icon" id="cancelCropBtn" title="בטל חיתוך" style="display: none;">
                                ✕
                            </button>
                            <button class="btn-icon" id="zoomOutBtn" title="הקטן" style="display: none;">
                                ➖
                            </button>
                            <button class="btn-icon" id="zoomInBtn" title="הגדל" style="display: none;">
                                ➕
                            </button>
                            <button class="btn-icon" id="resetZoomBtn" title="איפוס זום" style="display: none;">
                                🔍
                            </button>
                            <button class="btn-icon" id="expandBtn" title="הגדל/הקטן">
                                ⛶
                            </button>
                            <button class="btn-icon" id="downloadBtn" title="הורד תמונה" style="display: none;">
                                💾
                            </button>
                        </div>
                    </div>

                    <div class="image-viewer" id="imageViewer">
                        <div class="image-placeholder">
                            <div class="placeholder-icon">🖼️</div>
                            <p class="placeholder-text">לא נבחרה תמונה</p>
                            <p class="placeholder-hint">בחר תמונה מימין כדי להתחיל</p>
                        </div>
                        <div class="image-zoom-container" id="imageZoomContainer" style="display: none;">
                            <img id="displayImage" class="display-image" alt="Image">
                        </div>
                    </div>

                    <div class="panel-content-scrollable" id="panelContentScrollable">
                        <div class="image-info" id="imageInfo" style="display: none;">
                            <div class="info-item">
                                <span class="info-label">פרשה מזוהה:</span>
                                <span class="info-value" id="parachaName">-</span>
                                <span class="info-value status-pill" id="parachaStatus" style="margin-right:8px;"></span>
                                <span class="info-value status-pill" id="errorsStatus" style="margin-right:8px;"></span>
                                <span id="successMessage" style="display: none; margin-right: 10px;"></span>
                            </div>
                            <div class="info-item" id="detectedTextItem" style="display: none;">
                                <span class="info-label">טקסט מזוהה:</span>
                                <div class="info-value detected-text" id="detectedText" style="display: block;">-</div>
                            </div>
                        </div>

                        <div class="legend" id="legend" style="display: none;">
                            <div class="legend-title">מקרא</div>
                            <div class="legend-items">
                                <div class="legend-item">
                                    <div class="legend-color legend-green"></div>
                                    <span class="legend-label">אותיות נכונות</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-red"></div>
                                    <span class="legend-label">אותיות חסרות</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-blue"></div>
                                    <span class="legend-label">אותיות מיותרות</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-orange"></div>
                                    <span class="legend-label">אותיות שגויות</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="differences-section" id="differencesInfo" style="display: none;">
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="app-footer">
            <p>&copy; 2024 סתם סת"ם - בדיקת פרשה</p>
        </footer>
    </div>

    <script>
        // Vérifier la connexion avant de charger l'application
        window.addEventListener('DOMContentLoaded', () => {
            const userEmail = localStorage.getItem('stamstam_user_email');
            if (!userEmail) {
                window.location.href = 'login.html';
            }
        });
    </script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
